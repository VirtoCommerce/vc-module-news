import{s as Ie,m as Be,e as Re,r as je,u as De}from"./app-vendor-vue-reactivity82813.js";import{o as We,i as ne,d as _e,m as Ve,n as Fe,p as qe,j as Ke}from"./app-vendor-vue-runtime-core82813.js";import{H as O,z as Ue,A as Tt,p as G,D as Ge,G as E,l as W,o as Je,w as Xe,c as Ye,s as Qe,f as Ze,_ as tn,Y as en,n as nn,i as rn,e as sn,X as on,Q as an,Z as ln,t as dn,L as cn,a as un,K as pn,b as hn,$ as mn,d as A,u as fn,O as gn,g as bn,h as P,j as yn,J as et,B as kn,k as Ht,m as vn,V as Mn,r as wn,q as re,F as xn,v as se,y as $n,P as nt,x as Tn,M as Cn,C as Sn,E as An,W as En,U as On,I as Ln,N as Pn,R as Hn,S as Nt,T as Nn,a0 as zt,a1 as zn,a2 as It,a3 as Bt,a4 as In,a5 as Bn,a6 as Rn,a7 as jn,a8 as Dn,a9 as Wn,aa as _n,ab as oe,ac as Vn,ad as Fn,ae as qn,af as Kn,ag as N}from"./vc-shell-vendor-prosemirror82813.js";import{z as Rt,T as Un,B as ie,M as Gn}from"./vc-shell-vendor-linkifyjs82813.js";import{w as ae,O as Jn}from"./vc-shell-vendor-markdown82813.js";function at(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,o=n.storedMarks,n}}}let lt=class{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:s}=n,{tr:o}=r,i=this.buildProps(o);return Object.fromEntries(Object.entries(e).map(([a,d])=>[a,(...l)=>{const c=d(...l)(i);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(o),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:s,state:o}=this,{view:i}=s,a=[],d=!!e,l=e||o.tr,c=()=>(!d&&n&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),a.every(p=>p===!0)),u={...Object.fromEntries(Object.entries(r).map(([p,h])=>[p,(...g)=>{const m=this.buildProps(l,n),f=h(...g)(m);return a.push(f),u}])),run:c};return u}createCan(e){const{rawCommands:n,state:r}=this,s=!1,o=e||r.tr,i=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(n).map(([a,d])=>[a,(...l)=>d(...l)({...i,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(e,n=!0){const{rawCommands:r,editor:s,state:o}=this,{view:i}=s,a={tr:e,editor:s,view:i,state:at({state:o,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([d,l])=>[d,(...c)=>l(...c)(a)]))}};return a}},Xn=class{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(s=>s.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(s=>s!==n):delete this.callbacks[e]),this}once(e,n){const r=(...s)=>{this.off(e,r),n.apply(this,s)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}};function b(t,e,n){return t.config[e]===void 0&&t.parent?b(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?b(t.parent,e,n):null}):t.config[e]}function dt(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function le(t){const e=[],{nodeExtensions:n,markExtensions:r}=dt(t),s=[...n,...r],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage,extensions:s},d=b(i,"addGlobalAttributes",a);d&&d().forEach(l=>{l.types.forEach(c=>{Object.entries(l.attributes).forEach(([u,p])=>{e.push({type:c,name:u,attribute:{...o,...p}})})})})}),s.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},d=b(i,"addAttributes",a);if(!d)return;const l=d();Object.entries(l).forEach(([c,u])=>{const p={...o,...u};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:i.name,name:c,attribute:p})})}),e}function C(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function x(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,o])=>{if(!r[s]){r[s]=o;return}if(s==="class"){const i=o?String(o).split(" "):[],a=r[s]?r[s].split(" "):[],d=i.filter(l=>!a.includes(l));r[s]=[...a,...d].join(" ")}else if(s==="style"){const i=o?o.split(";").map(l=>l.trim()).filter(Boolean):[],a=r[s]?r[s].split(";").map(l=>l.trim()).filter(Boolean):[],d=new Map;a.forEach(l=>{const[c,u]=l.split(":").map(p=>p.trim());d.set(c,u)}),i.forEach(l=>{const[c,u]=l.split(":").map(p=>p.trim());d.set(c,u)}),r[s]=Array.from(d.entries()).map(([l,c])=>`${l}: ${c}`).join("; ")}else r[s]=o}),r},{})}function kt(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>x(n,r),{})}function de(t){return typeof t=="function"}function k(t,e=void 0,...n){return de(t)?e?t.bind(e)(...n):t(...n):t}function Yn(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Qn(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function jt(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(n):Qn(n.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...r,...s}}}}function Dt(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Yn(n)?!1:n!=null))}function Zn(t,e){var n;const r=le(t),{nodeExtensions:s,markExtensions:o}=dt(t),i=(n=s.find(l=>b(l,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(s.map(l=>{const c=r.filter(y=>y.type===l.name),u={name:l.name,options:l.options,storage:l.storage,editor:e},p=t.reduce((y,v)=>{const w=b(v,"extendNodeSchema",u);return{...y,...w?w(l):{}}},{}),h=Dt({...p,content:k(b(l,"content",u)),marks:k(b(l,"marks",u)),group:k(b(l,"group",u)),inline:k(b(l,"inline",u)),atom:k(b(l,"atom",u)),selectable:k(b(l,"selectable",u)),draggable:k(b(l,"draggable",u)),code:k(b(l,"code",u)),whitespace:k(b(l,"whitespace",u)),linebreakReplacement:k(b(l,"linebreakReplacement",u)),defining:k(b(l,"defining",u)),isolating:k(b(l,"isolating",u)),attrs:Object.fromEntries(c.map(y=>{var v;return[y.name,{default:(v=y?.attribute)===null||v===void 0?void 0:v.default}]}))}),g=k(b(l,"parseHTML",u));g&&(h.parseDOM=g.map(y=>jt(y,c)));const m=b(l,"renderHTML",u);m&&(h.toDOM=y=>m({node:y,HTMLAttributes:kt(y,c)}));const f=b(l,"renderText",u);return f&&(h.toText=f),[l.name,h]})),d=Object.fromEntries(o.map(l=>{const c=r.filter(f=>f.type===l.name),u={name:l.name,options:l.options,storage:l.storage,editor:e},p=t.reduce((f,y)=>{const v=b(y,"extendMarkSchema",u);return{...f,...v?v(l):{}}},{}),h=Dt({...p,inclusive:k(b(l,"inclusive",u)),excludes:k(b(l,"excludes",u)),group:k(b(l,"group",u)),spanning:k(b(l,"spanning",u)),code:k(b(l,"code",u)),attrs:Object.fromEntries(c.map(f=>{var y;return[f.name,{default:(y=f?.attribute)===null||y===void 0?void 0:y.default}]}))}),g=k(b(l,"parseHTML",u));g&&(h.parseDOM=g.map(f=>jt(f,c)));const m=b(l,"renderHTML",u);return m&&(h.toDOM=f=>m({mark:f,HTMLAttributes:kt(f,c)})),[l.name,h]}));return new se({topNode:i,nodes:a,marks:d})}function ft(t,e){return e.nodes[t]||e.marks[t]||null}function Wt(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function J(t,e){const n=fn.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}const tr=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,o,i,a)=>{var d,l;const c=((l=(d=s.type.spec).toText)===null||l===void 0?void 0:l.call(d,{node:s,pos:o,parent:i,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?c:c.slice(0,Math.max(0,r-o))}),n};function Ct(t){return Object.prototype.toString.call(t)==="[object RegExp]"}let ct=class{constructor(e){this.find=e.find,this.handler=e.handler}};const er=(t,e)=>{if(Ct(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith),r.push(n.replaceWith)),r};function X(t){var e;const{editor:n,from:r,to:s,text:o,rules:i,plugin:a}=t,{view:d}=n;if(d.composing)return!1;const l=d.state.doc.resolve(r);if(l.parent.type.spec.code||!((e=l.nodeBefore||l.nodeAfter)===null||e===void 0)&&e.marks.find(p=>p.type.spec.code))return!1;let c=!1;const u=tr(l)+o;return i.forEach(p=>{if(c)return;const h=er(u,p.find);if(!h)return;const g=d.state.tr,m=at({state:d.state,transaction:g}),f={from:r-(h[0].length-o.length),to:s},{commands:y,chain:v,can:w}=new lt({editor:n,state:m});p.handler({state:m,range:f,match:h,commands:y,chain:v,can:w})===null||!g.steps.length||(g.setMeta(a,{transform:g,from:r,to:s,text:o}),d.dispatch(g),c=!0)}),c}function nr(t){const{editor:e,rules:n}=t,r=new E({state:{init(){return null},apply(s,o,i){const a=s.getMeta(r);if(a)return a;const d=s.getMeta("applyInputRules");return d&&setTimeout(()=>{let{text:l}=d;typeof l=="string"?l=l:l=J(P.from(l),i.schema);const{from:c}=d,u=c+l.length;X({editor:e,from:c,to:u,text:l,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:o}},props:{handleTextInput(s,o,i,a){return X({editor:e,from:o,to:i,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:o}=s.state.selection;o&&X({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,o){if(o.key!=="Enter")return!1;const{$cursor:i}=s.state.selection;return i?X({editor:e,from:i.pos,to:i.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function rr(t){return Object.prototype.toString.call(t).slice(8,-1)}function Y(t){return rr(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function ut(t,e){const n={...t};return Y(t)&&Y(e)&&Object.keys(e).forEach(r=>{Y(e[r])&&Y(t[r])?n[r]=ut(t[r],e[r]):n[r]=e[r]}),n}let L=class vt{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=k(b(this,"addOptions",{name:this.name}))),this.storage=k(b(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new vt(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ut(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new vt(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0,n.options=k(b(n,"addOptions",{name:n.name})),n.storage=k(b(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!o.find(a=>a?.type.name===n.name))return!1;const i=o.find(a=>a?.type.name===n.name);return i&&r.removeStoredMark(i),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}};function sr(t){return typeof t=="number"}class or{constructor(e){this.find=e.find,this.handler=e.handler}}const ir=(t,e,n)=>{if(Ct(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const o=[s.text];return o.index=s.index,o.input=t,o.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith),o.push(s.replaceWith)),o}):[]};function ar(t){const{editor:e,state:n,from:r,to:s,rule:o,pasteEvent:i,dropEvent:a}=t,{commands:d,chain:l,can:c}=new lt({editor:e,state:n}),u=[];return n.doc.nodesBetween(r,s,(p,h)=>{if(!p.isTextblock||p.type.spec.code)return;const g=Math.max(r,h),m=Math.min(s,h+p.content.size),f=p.textBetween(g-h,m-h,void 0,"ï¿¼");ir(f,o.find,i).forEach(y=>{if(y.index===void 0)return;const v=g+y.index+1,w=v+y[0].length,$={from:n.tr.mapping.map(v),to:n.tr.mapping.map(w)},S=o.handler({state:n,range:$,match:y,commands:d,chain:l,can:c,pasteEvent:i,dropEvent:a});u.push(S)})}),u.every(p=>p!==null)}let Q=null;const lr=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function dr(t){const{editor:e,rules:n}=t;let r=null,s=!1,o=!1,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const d=({state:l,from:c,to:u,rule:p,pasteEvt:h})=>{const g=l.tr,m=at({state:l,transaction:g});if(!(!ar({editor:e,state:m,from:Math.max(c-1,0),to:u.b-1,rule:p,pasteEvent:h,dropEvent:a})||!g.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return n.map(l=>new E({view(c){const u=h=>{var g;r=!((g=c.dom.parentElement)===null||g===void 0)&&g.contains(h.target)?c.dom.parentElement:null,r&&(Q=e)},p=()=>{Q&&(Q=null)};return window.addEventListener("dragstart",u),window.addEventListener("dragend",p),{destroy(){window.removeEventListener("dragstart",u),window.removeEventListener("dragend",p)}}},props:{handleDOMEvents:{drop:(c,u)=>{if(o=r===c.dom.parentElement,a=u,!o){const p=Q;p?.isEditable&&setTimeout(()=>{const h=p.state.selection;h&&p.commands.deleteRange({from:h.from,to:h.to})},10)}return!1},paste:(c,u)=>{var p;const h=(p=u.clipboardData)===null||p===void 0?void 0:p.getData("text/html");return i=u,s=!!h?.includes("data-pm-slice"),!1}}},appendTransaction:(c,u,p)=>{const h=c[0],g=h.getMeta("uiEvent")==="paste"&&!s,m=h.getMeta("uiEvent")==="drop"&&!o,f=h.getMeta("applyPasteRules"),y=!!f;if(!g&&!m&&!y)return;if(y){let{text:$}=f;typeof $=="string"?$=$:$=J(P.from($),p.schema);const{from:S}=f,H=S+$.length,z=lr($);return d({rule:l,state:p,from:S,to:{b:H},pasteEvt:z})}const v=u.doc.content.findDiffStart(p.doc.content),w=u.doc.content.findDiffEnd(p.doc.content);if(!(!sr(v)||!w||v===w.b))return d({rule:l,state:p,from:v,to:w,pasteEvt:i})}}))}function cr(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}let ur=class F{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=F.resolve(e),this.schema=Zn(this.extensions,n),this.setupExtensions()}static resolve(e){const n=F.sort(F.flatten(e));return cr(n.map(s=>s.name)).length,n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},s=b(n,"addExtensions",r);return s?[n,...this.flatten(s())]:n}).flat(10)}static sort(e){return e.sort((n,r)=>{const s=b(n,"priority")||100,o=b(r,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:ft(n.name,this.schema)},s=b(n,"addCommands",r);return s?{...e,...s()}:e},{})}get plugins(){const{editor:e}=this,n=F.sort([...this.extensions].reverse()),r=[],s=[],o=n.map(i=>{const a={name:i.name,options:i.options,storage:i.storage,editor:e,type:ft(i.name,this.schema)},d=[],l=b(i,"addKeyboardShortcuts",a);let c={};if(i.type==="mark"&&b(i,"exitable",a)&&(c.ArrowRight=()=>L.handleExit({editor:e,mark:i})),l){const m=Object.fromEntries(Object.entries(l()).map(([f,y])=>[f,()=>y({editor:e})]));c={...c,...m}}const u=mn(c);d.push(u);const p=b(i,"addInputRules",a);Wt(i,e.options.enableInputRules)&&p&&r.push(...p());const h=b(i,"addPasteRules",a);Wt(i,e.options.enablePasteRules)&&h&&s.push(...h());const g=b(i,"addProseMirrorPlugins",a);if(g){const m=g();d.push(...m)}return d}).flat();return[nr({editor:e,rules:r}),...dr({editor:e,rules:s}),...o]}get attributes(){return le(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=dt(this.extensions);return Object.fromEntries(n.filter(r=>!!b(r,"addNodeView")).map(r=>{const s=this.attributes.filter(d=>d.type===r.name),o={name:r.name,options:r.options,storage:r.storage,editor:e,type:C(r.name,this.schema)},i=b(r,"addNodeView",o);if(!i)return[];const a=(d,l,c,u,p)=>{const h=kt(d,s);return i()({node:d,view:l,getPos:c,decorations:u,innerDecorations:p,editor:e,extension:r,HTMLAttributes:h})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:ft(e.name,this.schema)};e.type==="mark"&&(!((n=k(b(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const s=b(e,"onBeforeCreate",r),o=b(e,"onCreate",r),i=b(e,"onUpdate",r),a=b(e,"onSelectionUpdate",r),d=b(e,"onTransaction",r),l=b(e,"onFocus",r),c=b(e,"onBlur",r),u=b(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),o&&this.editor.on("create",o),i&&this.editor.on("update",i),a&&this.editor.on("selectionUpdate",a),d&&this.editor.on("transaction",d),l&&this.editor.on("focus",l),c&&this.editor.on("blur",c),u&&this.editor.on("destroy",u)})}};class T{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=k(b(this,"addOptions",{name:this.name}))),this.storage=k(b(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new T(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ut(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new T({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0,n.options=k(b(n,"addOptions",{name:n.name})),n.storage=k(b(n,"addStorage",{name:n.name,options:n.options})),n}}function ce(t,e,n){const{from:r,to:s}=e,{blockSeparator:o=`

`,textSerializers:i={}}=n||{};let a="";return t.nodesBetween(r,s,(d,l,c,u)=>{var p;d.isBlock&&l>r&&(a+=o);const h=i?.[d.type.name];if(h)return c&&(a+=h({node:d,pos:l,parent:c,index:u,range:e})),!1;d.isText&&(a+=(p=d?.text)===null||p===void 0?void 0:p.slice(Math.max(r,l)-l,s-l))}),a}function ue(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const pe=T.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new E({key:new O("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:o}=s,i=Math.min(...o.map(l=>l.$from.pos)),a=Math.max(...o.map(l=>l.$to.pos)),d=ue(n);return ce(r,{from:i,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:d})}}})]}}),pr=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),hr=(t=!1)=>({commands:e})=>e.setContent("",t),mr=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:o,$to:i})=>{t.doc.nodesBetween(o.pos,i.pos,(a,d)=>{if(a.type.isText)return;const{doc:l,mapping:c}=e,u=l.resolve(c.map(d)),p=l.resolve(c.map(d+a.nodeSize)),h=u.blockRange(p);if(!h)return;const g=xn(h);if(a.type.isTextblock){const{defaultType:m}=u.parent.contentMatchAt(u.index());e.setNodeMarkup(h.start,m)}(g||g===0)&&e.lift(h,g)})}),!0},fr=t=>e=>t(e),gr=()=>({state:t,dispatch:e})=>hn(t,e),br=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,o=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const i=r.mapping.map(e);return r.insert(i,o.content),r.setSelection(new A(r.doc.resolve(Math.max(i-1,0)))),!0},yr=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===r.type){if(e){const i=s.before(o),a=s.after(o);t.delete(i,a).scrollIntoView()}return!0}return!1},kr=t=>({tr:e,state:n,dispatch:r})=>{const s=C(t,n.schema),o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===s){if(r){const a=o.before(i),d=o.after(i);e.delete(a,d).scrollIntoView()}return!0}return!1},vr=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},Mr=()=>({state:t,dispatch:e})=>pn(t,e),wr=()=>({commands:t})=>t.keyboardShortcut("Enter"),xr=()=>({state:t,dispatch:e})=>un(t,e);function st(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:Ct(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function he(t,e,n={}){return t.find(r=>r.type===e&&st(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function _t(t,e,n={}){return!!he(t,e,n)}function St(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(l=>l.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(l=>l.type===e)||(n=n||((r=s.node.marks[0])===null||r===void 0?void 0:r.attrs),!he([...s.node.marks],e,n)))return;let o=s.index,i=t.start()+s.offset,a=o+1,d=i+s.node.nodeSize;for(;o>0&&_t([...t.parent.child(o-1).marks],e,n);)o-=1,i-=t.parent.child(o).nodeSize;for(;a<t.parent.childCount&&_t([...t.parent.child(a).marks],e,n);)d+=t.parent.child(a).nodeSize,a+=1;return{from:i,to:d}}function B(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const $r=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const o=B(t,r.schema),{doc:i,selection:a}=n,{$from:d,from:l,to:c}=a;if(s){const u=St(d,o,e);if(u&&u.from<=l&&u.to>=c){const p=A.create(i,u.from,u.to);n.setSelection(p)}}return!0},Tr=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function me(t){return t instanceof A}function D(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function fe(t,e=null){if(!e)return null;const n=W.atStart(t),r=W.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,o=r.to;return e==="all"?A.create(t,D(0,s,o),D(t.content.size,s,o)):A.create(t,D(e,s,o),D(e,s,o))}function Cr(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function At(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const Sr=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:o})=>{e={scrollIntoView:!0,...e};const i=()=>{(At()||Cr())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(o&&t===null&&!me(n.state.selection))return i(),!0;const a=fe(s.doc,t)||n.state.selection,d=n.state.selection.eq(a);return o&&(d||s.setSelection(a),d&&s.storedMarks&&s.setStoredMarks(s.storedMarks),i()),!0},Ar=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),Er=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),ge=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&ge(r)}return t};function Z(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return ge(n)}function q(t,e,n){if(t instanceof $n||t instanceof P)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return P.fromArray(t.map(i=>e.nodeFromJSON(i)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return q("",e,n)}if(s){if(n.errorOnInvalidContent){let i=!1,a="";const d=new se({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:l=>(i=!0,a=typeof l=="string"?l:l.outerHTML,null)}]}})});if(n.slice?nt.fromSchema(d).parseSlice(Z(t),n.parseOptions):nt.fromSchema(d).parse(Z(t),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const o=nt.fromSchema(e);return n.slice?o.parseSlice(Z(t),n.parseOptions).content:o.parse(Z(t),n.parseOptions)}return q("",e,n)}function Or(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof Tn||s instanceof Cn))return;const o=t.mapping.maps[r];let i=0;o.forEach((a,d,l,c)=>{i===0&&(i=c)}),t.setSelection(W.near(t.doc.resolve(i),n))}const Lr=t=>!("type"in t),Pr=(t,e,n)=>({tr:r,dispatch:s,editor:o})=>{var i;if(s){n={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const d=m=>{o.emit("contentError",{editor:o,error:m,disableCollaboration:()=>{o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},l={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{q(e,o.schema,{parseOptions:l,errorOnInvalidContent:!0})}catch(m){d(m)}try{a=q(e,o.schema,{parseOptions:l,errorOnInvalidContent:(i=n.errorOnInvalidContent)!==null&&i!==void 0?i:o.options.enableContentCheck})}catch(m){return d(m),!1}let{from:c,to:u}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,h=!0;if((Lr(a)?a:[a]).forEach(m=>{m.check(),p=p?m.isText&&m.marks.length===0:!1,h=h?m.isBlock:!1}),c===u&&h){const{parent:m}=r.doc.resolve(c);m.isTextblock&&!m.type.spec.code&&!m.childCount&&(c-=1,u+=1)}let g;if(p){if(Array.isArray(e))g=e.map(m=>m.text||"").join("");else if(e instanceof P){let m="";e.forEach(f=>{f.text&&(m+=f.text)}),g=m}else typeof e=="object"&&e&&e.text?g=e.text:g=e;r.insertText(g,c,u)}else g=a,r.replaceWith(c,u,g);n.updateSelection&&Or(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:c,text:g}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:c,text:g})}return!0},Hr=()=>({state:t,dispatch:e})=>sn(t,e),Nr=()=>({state:t,dispatch:e})=>dn(t,e),zr=()=>({state:t,dispatch:e})=>cn(t,e),Ir=()=>({state:t,dispatch:e})=>ln(t,e),Br=()=>({state:t,dispatch:e,tr:n})=>{try{const r=re(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Rr=()=>({state:t,dispatch:e,tr:n})=>{try{const r=re(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},jr=()=>({state:t,dispatch:e})=>an(t,e),Dr=()=>({state:t,dispatch:e})=>on(t,e);function be(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Wr(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,o,i;for(let a=0;a<e.length-1;a+=1){const d=e[a];if(/^(cmd|meta|m)$/i.test(d))i=!0;else if(/^a(lt)?$/i.test(d))r=!0;else if(/^(c|ctrl|control)$/i.test(d))s=!0;else if(/^s(hift)?$/i.test(d))o=!0;else if(/^mod$/i.test(d))At()||be()?i=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${d}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}const _r=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const o=Wr(t).split(/-(?!$)/),i=o.find(l=>!["Alt","Ctrl","Meta","Shift"].includes(l)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0});return e.captureTransaction(()=>{n.someProp("handleKeyDown",l=>l(n,a))})?.steps.forEach(l=>{const c=l.map(r.mapping);c&&s&&r.maybeStep(c)}),!0};function K(t,e,n={}){const{from:r,to:s,empty:o}=t.selection,i=e?C(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(c,u)=>{if(c.isText)return;const p=Math.max(r,u),h=Math.min(s,u+c.nodeSize);a.push({node:c,from:p,to:h})});const d=s-r,l=a.filter(c=>i?i.name===c.node.type.name:!0).filter(c=>st(c.node.attrs,n,{strict:!1}));return o?!!l.length:l.reduce((c,u)=>c+u.to-u.from,0)>=d}const Vr=(t,e={})=>({state:n,dispatch:r})=>{const s=C(t,n.schema);return K(n,s,e)?wn(n,r):!1},Fr=()=>({state:t,dispatch:e})=>rn(t,e),qr=t=>({state:e,dispatch:n})=>{const r=C(t,e.schema);return Mn(r)(e,n)},Kr=()=>({state:t,dispatch:e})=>nn(t,e);function pt(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Vt(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}const Ur=(t,e)=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const a=pt(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(o=C(t,r.schema)),a==="mark"&&(i=B(t,r.schema)),s&&n.selection.ranges.forEach(d=>{r.doc.nodesBetween(d.$from.pos,d.$to.pos,(l,c)=>{o&&o===l.type&&n.setNodeMarkup(c,void 0,Vt(l.attrs,e)),i&&l.marks.length&&l.marks.forEach(u=>{i===u.type&&n.addMark(c,c+l.nodeSize,i.create(Vt(u.attrs,e)))})})}),!0):!1},Gr=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Jr=()=>({tr:t,dispatch:e})=>{if(e){const n=new vn(t.doc);t.setSelection(n)}return!0},Xr=()=>({state:t,dispatch:e})=>en(t,e),Yr=()=>({state:t,dispatch:e})=>tn(t,e),Qr=()=>({state:t,dispatch:e})=>Ze(t,e),Zr=()=>({state:t,dispatch:e})=>Qe(t,e),ts=()=>({state:t,dispatch:e})=>Ye(t,e);function Mt(t,e,n={},r={}){return q(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const es=(t,e=!1,n={},r={})=>({editor:s,tr:o,dispatch:i,commands:a})=>{var d,l;const{doc:c}=o;if(n.preserveWhitespace!=="full"){const u=Mt(t,s.schema,n,{errorOnInvalidContent:(d=r.errorOnInvalidContent)!==null&&d!==void 0?d:s.options.enableContentCheck});return i&&o.replaceWith(0,c.content.size,u).setMeta("preventUpdate",!e),!0}return i&&o.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:c.content.size},t,{parseOptions:n,errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:s.options.enableContentCheck})};function ye(t,e){const n=B(e,t.schema),{from:r,to:s,empty:o}=t.selection,i=[];o?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,d=>{i.push(...d.marks)});const a=i.find(d=>d.type.name===n.name);return a?{...a.attrs}:{}}function ns(t,e){const n=new Ge(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function rs(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function ss(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,o)=>{n(s)&&r.push({node:s,pos:o})}),r}function ke(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Et(t){return e=>ke(e.$from,t)}function os(t,e){const n={from:0,to:t.content.size};return ce(t,n,e)}function is(t,e){const n=C(e,t.schema),{from:r,to:s}=t.selection,o=[];t.doc.nodesBetween(r,s,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===n.name);return i?{...i.attrs}:{}}function ve(t,e){const n=pt(typeof e=="string"?e:e.name,t.schema);return n==="node"?is(t,e):n==="mark"?ye(t,e):{}}function as(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function ls(t){const e=as(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function ds(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,o)=>{const i=[];if(s.ranges.length)s.forEach((a,d)=>{i.push({from:a,to:d})});else{const{from:a,to:d}=n[o];if(a===void 0||d===void 0)return;i.push({from:a,to:d})}i.forEach(({from:a,to:d})=>{const l=e.slice(o).map(a,-1),c=e.slice(o).map(d),u=e.invert().map(l,-1),p=e.invert().map(c);r.push({oldRange:{from:u,to:p},newRange:{from:l,to:c}})})}),ls(r)}function Ot(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const o=n.resolve(t),i=St(o,s.type);i&&r.push({mark:s,...i})}):n.nodesBetween(t,e,(s,o)=>{!s||s?.nodeSize===void 0||r.push(...s.marks.map(i=>({from:o,to:o+s.nodeSize,mark:i})))}),r}function rt(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(o=>o.type===e&&o.name===r);return s?s.attribute.keepOnSplit:!1}))}function wt(t,e,n={}){const{empty:r,ranges:s}=t.selection,o=e?B(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(c=>o?o.name===c.type.name:!0).find(c=>st(c.attrs,n,{strict:!1}));let i=0;const a=[];if(s.forEach(({$from:c,$to:u})=>{const p=c.pos,h=u.pos;t.doc.nodesBetween(p,h,(g,m)=>{if(!g.isText&&!g.marks.length)return;const f=Math.max(p,m),y=Math.min(h,m+g.nodeSize),v=y-f;i+=v,a.push(...g.marks.map(w=>({mark:w,from:f,to:y})))})}),i===0)return!1;const d=a.filter(c=>o?o.name===c.mark.type.name:!0).filter(c=>st(c.mark.attrs,n,{strict:!1})).reduce((c,u)=>c+u.to-u.from,0),l=a.filter(c=>o?c.mark.type!==o&&c.mark.type.excludes(o):!0).reduce((c,u)=>c+u.to-u.from,0);return(d>0?d+l:d)>=i}function cs(t,e,n={}){if(!e)return K(t,null,n)||wt(t,null,n);const r=pt(e,t.schema);return r==="node"?K(t,e,n):r==="mark"?wt(t,e,n):!1}function Ft(t,e){const{nodeExtensions:n}=dt(e),r=n.find(i=>i.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},o=k(b(r,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function ht(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(o=>{s!==!1&&(ht(o,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function us(t){return t instanceof G}function ps(t,e,n){var r;const{selection:s}=e;let o=null;if(me(s)&&(o=s.$cursor),o){const a=(r=t.storedMarks)!==null&&r!==void 0?r:o.marks();return!!n.isInSet(a)||!a.some(d=>d.type.excludes(n))}const{ranges:i}=s;return i.some(({$from:a,$to:d})=>{let l=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,d.pos,(c,u,p)=>{if(l)return!1;if(c.isInline){const h=!p||p.type.allowsMarkType(n),g=!!n.isInSet(c.marks)||!c.marks.some(m=>m.type.excludes(n));l=h&&g}return!l}),l})}const hs=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:o}=n,{empty:i,ranges:a}=o,d=B(t,r.schema);if(s)if(i){const l=ye(r,d);n.addStoredMark(d.create({...l,...e}))}else a.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;r.doc.nodesBetween(c,u,(p,h)=>{const g=Math.max(h,c),m=Math.min(h+p.nodeSize,u);p.marks.find(f=>f.type===d)?p.marks.forEach(f=>{d===f.type&&n.addMark(g,m,d.create({...f.attrs,...e}))}):n.addMark(g,m,d.create(e))})});return ps(r,n,d)},ms=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),fs=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const o=C(t,n.schema);let i;return n.selection.$anchor.sameParent(n.selection.$head)&&(i=n.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:a})=>Ht(o,{...i,...e})(n)?!0:a.clearNodes()).command(({state:a})=>Ht(o,{...i,...e})(a,r)).run():!1},gs=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=D(t,0,r.content.size),o=G.create(r,s);e.setSelection(o)}return!0},bs=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:o}=typeof t=="number"?{from:t,to:t}:t,i=A.atStart(r).from,a=A.atEnd(r).to,d=D(s,i,a),l=D(o,i,a),c=A.create(r,d,l);e.setSelection(c)}return!0},ys=t=>({state:e,dispatch:n})=>{const r=C(t,e.schema);return kn(r)(e,n)};function qt(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e?.includes(s.type.name));t.tr.ensureMarks(r)}}const ks=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:o,doc:i}=e,{$from:a,$to:d}=o,l=s.extensionManager.attributes,c=rt(l,a.node().type.name,a.node().attrs);if(o instanceof G&&o.node.isBlock)return!a.parentOffset||!et(i,a.pos)?!1:(r&&(t&&qt(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const u=d.parentOffset===d.parent.content.size,p=a.depth===0?void 0:rs(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=u&&p?[{type:p,attrs:c}]:void 0,g=et(e.doc,e.mapping.map(a.pos),1,h);if(!h&&!g&&et(e.doc,e.mapping.map(a.pos),1,p?[{type:p}]:void 0)&&(g=!0,h=p?[{type:p,attrs:c}]:void 0),r){if(g&&(o instanceof A&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),p&&!u&&!a.parentOffset&&a.parent.type!==p)){const m=e.mapping.map(a.before()),f=e.doc.resolve(m);a.node(-1).canReplaceWith(f.index(),f.index()+1,p)&&e.setNodeMarkup(e.mapping.map(a.before()),p)}t&&qt(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return g},vs=(t,e={})=>({tr:n,state:r,dispatch:s,editor:o})=>{var i;const a=C(t,r.schema),{$from:d,$to:l}=r.selection,c=r.selection.node;if(c&&c.isBlock||d.depth<2||!d.sameParent(l))return!1;const u=d.node(-1);if(u.type!==a)return!1;const p=o.extensionManager.attributes;if(d.parent.content.size===0&&d.node(-1).childCount===d.indexAfter(-1)){if(d.depth===2||d.node(-3).type!==a||d.index(-2)!==d.node(-2).childCount-1)return!1;if(s){let y=P.empty;const v=d.index(-1)?1:d.index(-2)?2:3;for(let I=d.depth-v;I>=d.depth-3;I-=1)y=P.from(d.node(I).copy(y));const w=d.indexAfter(-1)<d.node(-2).childCount?1:d.indexAfter(-2)<d.node(-3).childCount?2:3,$={...rt(p,d.node().type.name,d.node().attrs),...e},S=((i=a.contentMatch.defaultType)===null||i===void 0?void 0:i.createAndFill($))||void 0;y=y.append(P.from(a.createAndFill(null,S)||void 0));const H=d.before(d.depth-(v-1));n.replace(H,d.after(-w),new yn(y,4-v,0));let z=-1;n.doc.nodesBetween(H,n.doc.content.size,(I,ze)=>{if(z>-1)return!1;I.isTextblock&&I.content.size===0&&(z=ze+1)}),z>-1&&n.setSelection(A.near(n.doc.resolve(z))),n.scrollIntoView()}return!0}const h=l.pos===d.end()?u.contentMatchAt(0).defaultType:null,g={...rt(p,u.type.name,u.attrs),...e},m={...rt(p,d.node().type.name,d.node().attrs),...e};n.delete(d.pos,l.pos);const f=h?[{type:a,attrs:g},{type:h,attrs:m}]:[{type:a,attrs:g}];if(!et(n.doc,d.pos,2))return!1;if(s){const{selection:y,storedMarks:v}=r,{splittableMarks:w}=o.extensionManager,$=v||y.$to.parentOffset&&y.$from.marks();if(n.split(d.pos,2,f).scrollIntoView(),!$||!s)return!0;const S=$.filter(H=>w.includes(H.type.name));n.ensureMarks(S)}return!0},gt=(t,e)=>{const n=Et(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===s?.type&&Tt(t.doc,n.pos)&&t.join(n.pos),!0},bt=(t,e)=>{const n=Et(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===s?.type&&Tt(t.doc,r)&&t.join(r),!0},Ms=(t,e,n,r={})=>({editor:s,tr:o,state:i,dispatch:a,chain:d,commands:l,can:c})=>{const{extensions:u,splittableMarks:p}=s.extensionManager,h=C(t,i.schema),g=C(e,i.schema),{selection:m,storedMarks:f}=i,{$from:y,$to:v}=m,w=y.blockRange(v),$=f||m.$to.parentOffset&&m.$from.marks();if(!w)return!1;const S=Et(H=>Ft(H.type.name,u))(m);if(w.depth>=1&&S&&w.depth-S.depth<=1){if(S.node.type===h)return l.liftListItem(g);if(Ft(S.node.type.name,u)&&h.validContent(S.node.content)&&a)return d().command(()=>(o.setNodeMarkup(S.pos,h),!0)).command(()=>gt(o,h)).command(()=>bt(o,h)).run()}return!n||!$||!a?d().command(()=>c().wrapInList(h,r)?!0:l.clearNodes()).wrapInList(h,r).command(()=>gt(o,h)).command(()=>bt(o,h)).run():d().command(()=>{const H=c().wrapInList(h,r),z=$.filter(I=>p.includes(I.type.name));return o.ensureMarks(z),H?!0:l.clearNodes()}).wrapInList(h,r).command(()=>gt(o,h)).command(()=>bt(o,h)).run()},ws=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:o=!1}=n,i=B(t,r.schema);return wt(r,i,e)?s.unsetMark(i,{extendEmptyMarkRange:o}):s.setMark(i,e)},xs=(t,e,n={})=>({state:r,commands:s})=>{const o=C(t,r.schema),i=C(e,r.schema),a=K(r,o,n);let d;return r.selection.$anchor.sameParent(r.selection.$head)&&(d=r.selection.$anchor.parent.attrs),a?s.setNode(i,d):s.setNode(o,{...d,...n})},$s=(t,e={})=>({state:n,commands:r})=>{const s=C(t,n.schema);return K(n,s,e)?r.lift(s):r.wrapIn(s,e)},Ts=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let o;if(s.spec.isInputRules&&(o=s.getState(t))){if(e){const i=t.tr,a=o.transform;for(let d=a.steps.length-1;d>=0;d-=1)i.step(a.steps[d].invert(a.docs[d]));if(o.text){const d=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,t.schema.text(o.text,d))}else i.delete(o.from,o.to)}return!0}}return!1},Cs=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},Ss=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var o;const{extendEmptyMarkRange:i=!1}=e,{selection:a}=n,d=B(t,r.schema),{$from:l,empty:c,ranges:u}=a;if(!s)return!0;if(c&&i){let{from:p,to:h}=a;const g=(o=l.marks().find(f=>f.type===d))===null||o===void 0?void 0:o.attrs,m=St(l,d,g);m&&(p=m.from,h=m.to),n.removeMark(p,h,d)}else u.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,d)});return n.removeStoredMark(d),!0},As=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let o=null,i=null;const a=pt(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(o=C(t,r.schema)),a==="mark"&&(i=B(t,r.schema)),s&&n.selection.ranges.forEach(d=>{const l=d.$from.pos,c=d.$to.pos;let u,p,h,g;n.selection.empty?r.doc.nodesBetween(l,c,(m,f)=>{o&&o===m.type&&(h=Math.max(f,l),g=Math.min(f+m.nodeSize,c),u=f,p=m)}):r.doc.nodesBetween(l,c,(m,f)=>{f<l&&o&&o===m.type&&(h=Math.max(f,l),g=Math.min(f+m.nodeSize,c),u=f,p=m),f>=l&&f<=c&&(o&&o===m.type&&n.setNodeMarkup(f,void 0,{...m.attrs,...e}),i&&m.marks.length&&m.marks.forEach(y=>{if(i===y.type){const v=Math.max(f,l),w=Math.min(f+m.nodeSize,c);n.addMark(v,w,i.create({...y.attrs,...e}))}}))}),p&&(u!==void 0&&n.setNodeMarkup(u,void 0,{...p.attrs,...e}),i&&p.marks.length&&p.marks.forEach(m=>{i===m.type&&n.addMark(h,g,i.create({...m.attrs,...e}))}))}),!0):!1},Es=(t,e={})=>({state:n,dispatch:r})=>{const s=C(t,n.schema);return bn(s,e)(n,r)},Os=(t,e={})=>({state:n,dispatch:r})=>{const s=C(t,n.schema);return gn(s,e)(n,r)};var Ls=Object.freeze({__proto__:null,blur:pr,clearContent:hr,clearNodes:mr,command:fr,createParagraphNear:gr,cut:br,deleteCurrentNode:yr,deleteNode:kr,deleteRange:vr,deleteSelection:Mr,enter:wr,exitCode:xr,extendMarkRange:$r,first:Tr,focus:Sr,forEach:Ar,insertContent:Er,insertContentAt:Pr,joinBackward:zr,joinDown:Nr,joinForward:Ir,joinItemBackward:Br,joinItemForward:Rr,joinTextblockBackward:jr,joinTextblockForward:Dr,joinUp:Hr,keyboardShortcut:_r,lift:Vr,liftEmptyBlock:Fr,liftListItem:qr,newlineInCode:Kr,resetAttributes:Ur,scrollIntoView:Gr,selectAll:Jr,selectNodeBackward:Xr,selectNodeForward:Yr,selectParentNode:Qr,selectTextblockEnd:Zr,selectTextblockStart:ts,setContent:es,setMark:hs,setMeta:ms,setNode:fs,setNodeSelection:gs,setTextSelection:bs,sinkListItem:ys,splitBlock:ks,splitListItem:vs,toggleList:Ms,toggleMark:ws,toggleNode:xs,toggleWrap:$s,undoInputRule:Ts,unsetAllMarks:Cs,unsetMark:Ss,updateAttributes:As,wrapIn:Es,wrapInList:Os});const Me=T.create({name:"commands",addCommands(){return{...Ls}}}),we=T.create({name:"drop",addProseMirrorPlugins(){return[new E({key:new O("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),xe=T.create({name:"editable",addProseMirrorPlugins(){return[new E({key:new O("editable"),props:{editable:()=>this.editor.options.editable}})]}}),$e=new O("focusEvents"),Te=T.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new E({key:$e,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),Ce=T.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:i})=>{const{selection:a,doc:d}=i,{empty:l,$anchor:c}=a,{pos:u,parent:p}=c,h=c.parent.isTextblock&&u>0?i.doc.resolve(u-1):c,g=h.parent.type.spec.isolating,m=c.pos-c.parentOffset,f=g&&h.parent.childCount===1?m===c.pos:W.atStart(d).from===u;return!l||!p.type.isTextblock||p.textContent.length||!f||f&&c.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},r={...n},s={...n,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return At()||be()?s:r},addProseMirrorPlugins(){return[new E({key:new O("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(h=>h.getMeta("composition")))return;const r=t.some(h=>h.docChanged)&&!e.doc.eq(n.doc),s=t.some(h=>h.getMeta("preventClearDocument"));if(!r||s)return;const{empty:o,from:i,to:a}=e.selection,d=W.atStart(e.doc).from,l=W.atEnd(e.doc).to;if(o||!(i===d&&a===l)||!ht(n.doc))return;const c=n.tr,u=at({state:n,transaction:c}),{commands:p}=new lt({editor:this.editor,state:u});if(p.clearNodes(),!!c.steps.length)return c}})]}}),Se=T.create({name:"paste",addProseMirrorPlugins(){return[new E({key:new O("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),Ae=T.create({name:"tabindex",addProseMirrorPlugins(){return[new E({key:new O("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});var Ps=Object.freeze({__proto__:null,ClipboardTextSerializer:pe,Commands:Me,Drop:we,Editable:xe,FocusEvents:Te,Keymap:Ce,Paste:Se,Tabindex:Ae,focusEventsPluginKey:$e});class j{get name(){return this.node.type.name}constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0)return;n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new j(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new j(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new j(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,o=n.isAtom&&!n.isText,i=this.pos+r+(o?0:1);if(i<0||i>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(i);if(!s&&a.depth<=this.depth)return;const d=new j(a,this.editor,s,s?n:null);s&&(d.actualDepth=this.depth+1),e.push(new j(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;)s.node.type.name===e&&(Object.keys(n).length>0||(r=s)),s=s.parent;return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const o=Object.keys(n);return this.children.forEach(i=>{r&&s.length>0||(i.node.type.name===e&&o.every(a=>n[a]===i.node.attrs[a])&&s.push(i),!(r&&s.length>0)&&(s=s.concat(i.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const Hs=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function Ns(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}let zs=class extends Xn{constructor(t={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:e})=>{throw e},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:e,slice:n,moved:r})=>this.options.onDrop(e,n,r)),this.on("paste",({event:e,slice:n})=>this.options.onPaste(e,n)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Ns(Hs,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,e){const n=de(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let n=e;if([].concat(t).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;n=n.filter(i=>!i.key.startsWith(o))}),e.length===n.length)return;const r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}createExtensionManager(){var t,e;const n=[...this.options.enableCoreExtensions?[xe,pe.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)===null||t===void 0?void 0:t.clipboardTextSerializer)===null||e===void 0?void 0:e.blockSeparator}),Me,Te,Ce,Ae,we,Se].filter(r=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[r.name]!==!1:!0):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r?.type));this.extensionManager=new ur(n,this)}createCommandManager(){this.commandManager=new lt({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var t;let e;try{e=Mt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(i=>i.name!=="collaboration"),this.createExtensionManager()}}),e=Mt(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const n=fe(e,this.options.autofocus);this.view=new Je(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)===null||t===void 0?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Xe.create({doc:e,selection:n||void 0})});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews(),this.prependClass();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(o=>{var i;return(i=this.capturedTransaction)===null||i===void 0?void 0:i.step(o)});return}const e=this.state.apply(t),n=!this.state.selection.eq(e.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const r=t.getMeta("focus"),s=t.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:t}),s&&this.emit("blur",{editor:this,event:s.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return ve(this.state,t)}isActive(t,e){const n=typeof t=="string"?t:null,r=typeof t=="string"?e:t;return cs(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return J(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:n={}}=t||{};return os(this.state.doc,{blockSeparator:e,textSerializers:{...ue(this.schema),...n}})}get isEmpty(){return ht(this.state.doc)}getCharacterCount(){return this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const t=this.view.dom;t&&t.editor&&delete t.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}$node(t,e){var n;return((n=this.$doc)===null||n===void 0?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return((n=this.$doc)===null||n===void 0?void 0:n.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new j(e,this)}get $doc(){return this.$pos(0)}};function V(t){return new ct({find:t.find,handler:({state:e,range:n,match:r})=>{const s=k(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:o}=e,i=r[r.length-1],a=r[0];if(i){const d=a.search(/\S/),l=n.from+a.indexOf(i),c=l+i.length;if(Ot(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(h=>h===t.type&&h!==p.mark.type)).filter(p=>p.to>l).length)return null;c<n.to&&o.delete(c,n.to),l>n.from&&o.delete(n.from+d,l);const u=n.from+d+i.length;o.addMark(n.from+d,u,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}function Ee(t){return new ct({find:t.find,handler:({state:e,range:n,match:r})=>{const s=k(t.getAttributes,void 0,r)||{},{tr:o}=e,i=n.from;let a=n.to;const d=t.type.create(s);if(r[1]){const l=r[0].lastIndexOf(r[1]);let c=i+l;c>a?c=a:a=c+r[1].length;const u=r[0][r[0].length-1];o.insertText(u,i+r[0].length-1),o.replaceWith(c,a,d)}else if(r[0]){const l=t.type.isInline?i:i-1;o.insert(l,t.type.create(s)).delete(o.mapping.map(i),o.mapping.map(a))}o.scrollIntoView()}})}function xt(t){return new ct({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),o=k(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,o)}})}function U(t){return new ct({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const o=k(t.getAttributes,void 0,r)||{},i=e.tr.delete(n.from,n.to),a=i.doc.resolve(n.from).blockRange(),d=a&&Ue(a,t.type,o);if(!d)return null;if(i.wrap(a,d),t.keepMarks&&t.editor){const{selection:c,storedMarks:u}=e,{splittableMarks:p}=t.editor.extensionManager,h=u||c.$to.parentOffset&&c.$from.marks();if(h){const g=h.filter(m=>p.includes(m.type.name));i.ensureMarks(g)}}if(t.keepAttributes){const c=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(c,o).run()}const l=i.doc.resolve(n.from-1).nodeBefore;l&&l.type===t.type&&Tt(i.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,l))&&i.join(n.from-1)}})}class M{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0,this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=k(b(this,"addOptions",{name:this.name}))),this.storage=k(b(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new M(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>ut(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new M(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0,n.options=k(b(n,"addOptions",{name:n.name})),n.storage=k(b(n,"addStorage",{name:n.name,options:n.options})),n}}function _(t){return new or({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const o=k(t.getAttributes,void 0,r,s);if(o===!1||o===null)return null;const{tr:i}=e,a=r[r.length-1],d=r[0];let l=n.to;if(a){const c=d.search(/\S/),u=n.from+d.indexOf(a),p=u+a.length;if(Ot(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(g=>g===t.type&&g!==h.mark.type)).filter(h=>h.to>u).length)return null;p<n.to&&i.delete(p,n.to),u>n.from&&i.delete(n.from+c,u),l=n.from+c+a.length,i.addMark(n.from+c,l,t.type.create(o||{})),i.removeStoredMark(t.type)}}})}function Is(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof G){const o=r.index();return r.parent.canReplaceWith(o,o+1,e)}let s=r.depth;for(;s>=0;){const o=r.index(s);if(r.node(s).contentMatchAt(o).matchType(e))return!0;s-=1}return!1}function Kt(t){return Re((e,n)=>({get(){return e(),t},set(r){t=r,requestAnimationFrame(()=>{requestAnimationFrame(()=>{n()})})}}))}let Bs=class extends zs{constructor(e={}){return super(e),this.contentComponent=null,this.appContext=null,this.reactiveState=Kt(this.view.state),this.reactiveExtensionStorage=Kt(this.extensionStorage),this.on("beforeTransaction",({nextState:n})=>{this.reactiveState.value=n,this.reactiveExtensionStorage.value=this.extensionStorage}),Be(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,n){const r=super.registerPlugin(e,n);return this.reactiveState&&(this.reactiveState.value=r),r}unregisterPlugin(e){const n=super.unregisterPlugin(e);return this.reactiveState&&n&&(this.reactiveState.value=n),n}};const _i=_e({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=je(),n=Ke();return Fe(()=>{const r=t.editor;r&&r.options.element&&e.value&&qe(()=>{if(!e.value||!r.options.element.firstChild)return;const s=De(e.value);e.value.append(...r.options.element.childNodes),r.contentComponent=n.ctx._,n&&(r.appContext={...n.appContext,provides:n.provides}),r.setOptions({element:s}),r.createNodeViews()})}),ne(()=>{const r=t.editor;r&&(r.contentComponent=null,r.appContext=null)}),{rootEl:e}},render(){return Ve("div",{ref:t=>{this.rootEl=t}})}}),Vi=(t={})=>{const e=Ie();return We(()=>{e.value=new Bs(t)}),ne(()=>{var n,r,s;const o=(n=e.value)===null||n===void 0?void 0:n.options.element,i=o?.cloneNode(!0);(r=o?.parentNode)===null||r===void 0||r.replaceChild(i,o),(s=e.value)===null||s===void 0||s.destroy()}),e},Rs=/^\s*>\s$/,js=M.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",x(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[U({find:Rs,type:this.type})]}}),Ds=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Ws=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,_s=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Vs=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Fs=L.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",x(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[V({find:Ds,type:this.type}),V({find:_s,type:this.type})]},addPasteRules(){return[_({find:Ws,type:this.type}),_({find:Vs,type:this.type})]}}),qs="listItem",Ut="textStyle",Gt=/^\s*([-+*])\s$/,Ks=M.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",x(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(qs,this.editor.getAttributes(Ut)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=U({find:Gt,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=U({find:Gt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Ut),editor:this.editor})),[t]}}),Us=/(^|[^`])`([^`]+)`(?!`)/,Gs=/(^|[^`])`([^`]+)`(?!`)/g,Js=L.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",x(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[V({find:Us,type:this.type})]},addPasteRules(){return[_({find:Gs,type:this.type})]}}),Xs=/^```([a-z]+)?[\s\n]$/,Ys=/^~~~([a-z]+)?[\s\n]$/,Qs=M.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;return[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(s=>s.startsWith(n)).map(s=>s.replace(n,""))[0]||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",x(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const o=r.parentOffset===r.parent.nodeSize-2,i=r.parent.textContent.endsWith(`

`);return!o||!i?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:o}=n;if(!o||s.parent.type!==this.type||s.parentOffset!==s.parent.nodeSize-2)return!1;const i=s.after();return i===void 0?!1:r.nodeAt(i)?t.commands.command(({tr:a})=>(a.setSelection(W.near(r.resolve(i))),!0)):t.commands.exitCode()}}},addInputRules(){return[xt({find:Xs,type:this.type,getAttributes:t=>({language:t[1]})}),xt({find:Ys,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new E({key:new O("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,o=s?.mode;if(!n||!o)return!1;const{tr:i,schema:a}=t.state,d=a.text(n.replace(/\r\n?/g,`
`));return i.replaceSelectionWith(this.type.create({language:o},d)),i.selection.$from.parent.type!==this.type&&i.setSelection(A.near(i.doc.resolve(Math.max(0,i.selection.from-2)))),i.setMeta("paste",!0),t.dispatch(i),!0}}})]}}),Zs=M.create({name:"doc",topNode:!0,content:"block+"}),to=T.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Sn(this.options)]}}),eo=T.create({name:"gapCursor",addProseMirrorPlugins(){return[An()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=k(b(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),no=M.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",x(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:o}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:a}=r.extensionManager,d=o||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:l,dispatch:c})=>{if(c&&d&&i){const u=d.filter(p=>a.includes(p.type.name));l.ensureMarks(u)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),ro=M.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,x(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>xt({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),so=T.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Ln(t,e),redo:()=>({state:t,dispatch:e})=>On(t,e)}},addProseMirrorPlugins(){return[En(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),oo=M.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",x(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!Is(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:s}=n,o=t();return r.parentOffset===0?o.insertContentAt({from:Math.max(r.pos-1,0),to:s.pos},{type:this.name}):us(n)?o.insertContentAt(s.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({tr:i,dispatch:a})=>{var d;if(a){const{$to:l}=i.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?i.setSelection(A.create(i.doc,l.pos+1)):l.nodeAfter.isBlock?i.setSelection(G.create(i.doc,l.pos)):i.setSelection(A.create(i.doc,l.pos));else{const u=(d=l.parent.type.contentMatch.defaultType)===null||d===void 0?void 0:d.create();u&&(i.insert(c,u),i.setSelection(A.create(i.doc,c+1)))}i.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Ee({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),io=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,ao=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,lo=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,co=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,uo=L.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",x(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[V({find:io,type:this.type}),V({find:lo,type:this.type})]},addPasteRules(){return[_({find:ao,type:this.type}),_({find:co,type:this.type})]}}),po=M.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",x(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ho="listItem",Jt="textStyle",Xt=/^(\d+)\.\s$/,mo=M.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",x(this.options.HTMLAttributes,n),0]:["ol",x(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ho,this.editor.getAttributes(Jt)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=U({find:Xt,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=U({find:Xt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Jt)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),fo=M.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",x(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),go=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,bo=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,yo=L.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",x(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[V({find:go,type:this.type})]},addPasteRules(){return[_({find:bo,type:this.type})]}}),ko=M.create({name:"text",group:"inline"}),Fi=T.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(Fs.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(js.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(Ks.configure(this.options.bulletList)),this.options.code!==!1&&t.push(Js.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(Qs.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(Zs.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(to.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(eo.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(no.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(ro.configure(this.options.heading)),this.options.history!==!1&&t.push(so.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(oo.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(uo.configure(this.options.italic)),this.options.listItem!==!1&&t.push(po.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(mo.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(fo.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(yo.configure(this.options.strike)),this.options.text!==!1&&t.push(ko.configure(this.options.text)),t}}),qi=L.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",x(this.options.HTMLAttributes,t),0]},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function $t(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function Yt(t,e,n,r,s,o){var i;let a=0,d=!0,l=e.firstChild;const c=t.firstChild;if(c!==null)for(let u=0,p=0;u<c.childCount;u+=1){const{colspan:h,colwidth:g}=c.child(u).attrs;for(let m=0;m<h;m+=1,p+=1){const f=s===p?o:g&&g[m],y=f?`${f}px`:"";if(a+=f||r,f||(d=!1),l){if(l.style.width!==y){const[v,w]=$t(r,f);l.style.setProperty(v,w)}l=l.nextSibling}else{const v=document.createElement("col"),[w,$]=$t(r,f);v.style.setProperty(w,$),e.appendChild(v)}}}for(;l;){const u=l.nextSibling;(i=l.parentNode)===null||i===void 0||i.removeChild(l),l=u}d?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}let vo=class{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Yt(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,Yt(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}};function Mo(t,e,n,r){let s=0,o=!0;const i=[],a=t.firstChild;if(!a)return{};for(let c=0,u=0;c<a.childCount;c+=1){const{colspan:p,colwidth:h}=a.child(c).attrs;for(let g=0;g<p;g+=1,u+=1){const m=n===u?r:h&&h[g];s+=m||e,m||(o=!1);const[f,y]=$t(e,m);i.push(["col",{style:`${f}: ${y}`}])}}const d=o?`${s}px`:"",l=o?"":`${s}px`;return{colgroup:["colgroup",{},...i],tableWidth:d,tableMinWidth:l}}function Qt(t,e){return t.createAndFill()}function wo(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function xo(t,e,n,r,s){const o=wo(t),i=[],a=[];for(let l=0;l<n;l+=1){const c=Qt(o.cell);if(c&&a.push(c),r){const u=Qt(o.header_cell);u&&i.push(u)}}const d=[];for(let l=0;l<e;l+=1)d.push(o.row.createChecked(null,r&&l===0?i:a));return o.table.createChecked(null,d)}function $o(t){return t instanceof oe}const tt=({editor:t})=>{const{selection:e}=t.state;if(!$o(e))return!1;let n=0;return ke(e.ranges[0].$from,s=>s.type.name==="table")?.node.descendants(s=>{if(s.type.name==="table")return!1;["tableCell","tableHeader"].includes(s.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},Ui=M.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:vo,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:r,tableMinWidth:s}=Mo(t,this.options.cellMinWidth);return["table",x(this.options.HTMLAttributes,e,{style:r?`width: ${r}`:`min-width: ${s}`}),n,["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:s,editor:o})=>{const i=xo(o.schema,t,e,n);if(s){const a=r.selection.from+1;r.replaceSelectionWith(i).scrollIntoView().setSelection(A.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>_n(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>Wn(t,e),deleteColumn:()=>({state:t,dispatch:e})=>Dn(t,e),addRowBefore:()=>({state:t,dispatch:e})=>jn(t,e),addRowAfter:()=>({state:t,dispatch:e})=>Rn(t,e),deleteRow:()=>({state:t,dispatch:e})=>Bn(t,e),deleteTable:()=>({state:t,dispatch:e})=>In(t,e),mergeCells:()=>({state:t,dispatch:e})=>Bt(t,e),splitCell:()=>({state:t,dispatch:e})=>zt(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>It("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>It("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>zn(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>Bt(t,e)?!0:zt(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>Nn(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>Nt(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>Nt(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Vn(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const r=oe.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:tt,"Mod-Backspace":tt,Delete:tt,"Mod-Delete":tt}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Pn({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Hn({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:k(b(t,"tableRole",e))}}}),Gi=M.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",x(this.options.HTMLAttributes,t),0]}}),Ji=M.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(n=>parseInt(n,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",x(this.options.HTMLAttributes,t),0]}}),Xi=M.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(n=>parseInt(n,10)):null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",x(this.options.HTMLAttributes,t),0]}}),Lt="[\0- Â áá â-\u2029âã]",To=new RegExp(Lt),Co=new RegExp(`${Lt}$`),So=new RegExp(Lt,"g");function Ao(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Eo(t){return new E({key:new O("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(d=>d.docChanged)&&!n.doc.eq(r.doc),o=e.some(d=>d.getMeta("preventAutolink"));if(!s||o)return;const{tr:i}=r,a=ns(n.doc,[...e]);if(ds(a).forEach(({newRange:d})=>{const l=ss(r.doc,d,p=>p.isTextblock);let c,u;if(l.length>1)c=l[0],u=r.doc.textBetween(c.pos,c.pos+c.node.nodeSize,void 0," ");else if(l.length){const p=r.doc.textBetween(d.from,d.to," "," ");if(!Co.test(p))return;c=l[0],u=r.doc.textBetween(c.pos,d.to,void 0," ")}if(c&&u){const p=u.split(To).filter(Boolean);if(p.length<=0)return!1;const h=p[p.length-1],g=c.pos+u.lastIndexOf(h);if(!h)return!1;const m=Un(h).map(f=>f.toObject(t.defaultProtocol));if(!Ao(m))return!1;m.filter(f=>f.isLink).map(f=>({...f,from:g+f.start+1,to:g+f.end+1})).filter(f=>r.schema.marks.code?!r.doc.rangeHasMark(f.from,f.to,r.schema.marks.code):!0).filter(f=>t.validate(f.value)).filter(f=>t.shouldAutoLink(f.value)).forEach(f=>{Ot(f.from,f.to,r.doc).some(y=>y.mark.type===t.type)||i.addMark(f.from,f.to,t.type.create({href:f.href}))})}}),!!i.steps.length)return i}})}function Oo(t){return new E({key:new O("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,o;if(r.button!==0||!e.editable)return!1;let i=r.target;const a=[];for(;i.nodeName!=="DIV";)a.push(i),i=i.parentNode;if(!a.find(p=>p.nodeName==="A"))return!1;const d=ve(e.state,t.type.name),l=r.target,c=(s=l?.href)!==null&&s!==void 0?s:d.href,u=(o=l?.target)!==null&&o!==void 0?o:d.target;return l&&c?(window.open(c,u),!0):!1}}})}function Lo(t){return new E({key:new O("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:s}=e,{selection:o}=s,{empty:i}=o;if(i)return!1;let a="";r.content.forEach(l=>{a+=l.textContent});const d=ie(a,{defaultProtocol:t.defaultProtocol}).find(l=>l.isLink&&l.value===a);return!a||!d?!1:t.editor.commands.setMark(t.type,{href:d.href})}}})}function R(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!t||t.replace(So,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const Yi=L.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate),this.options.protocols.forEach(t=>{if(typeof t=="string"){Rt(t);return}Rt(t.scheme,t.optionalSlashes)})},onDestroy(){Gn()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!R(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!R(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!R(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",x(this.options.HTMLAttributes,t),0]:["a",x(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!R(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!R(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[_({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,s=ie(t).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:i=>!!R(i,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(o=>e.push({text:o.value,data:{href:o.href},index:o.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(Eo({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!R(s,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(Oo({type:this.type})),this.options.linkOnPaste&&t.push(Lo({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),Po=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Qi=M.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",x(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[Ee({find:Po,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),Zi=T.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something â¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new E({key:new O("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,s=[];if(!n)return null;const o=this.editor.isEmpty;return t.descendants((i,a)=>{const d=r>=a&&r<=a+i.nodeSize,l=!i.isLeaf&&ht(i);if((d||!this.options.showOnlyCurrent)&&l){const c=[this.options.emptyNodeClass];o&&c.push(this.options.emptyEditorClass);const u=qn.node(a,a+i.nodeSize,{class:c.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:i,pos:a,hasAnchor:d}):this.options.placeholder});s.push(u)}return this.options.includeChildren}),Fn.create(t,s)}}})]}});var Ho=Object.defineProperty,No=(t,e,n)=>e in t?Ho(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ot=(t,e,n)=>(No(t,typeof e!="symbol"?e+"":e,n),n);const zo=T.create({name:"markdownTightLists",addOptions:()=>({tight:!0,tightClass:"tight",listTypes:["bulletList","orderedList"]}),addGlobalAttributes(){return[{types:this.options.listTypes,attributes:{tight:{default:this.options.tight,parseHTML:t=>t.getAttribute("data-tight")==="true"||!t.querySelector("p"),renderHTML:t=>({class:t.tight?this.options.tightClass:null,"data-tight":t.tight?"true":null})}}}]},addCommands(){var t=this;return{toggleTight:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return n=>{let{editor:r,commands:s}=n;function o(i){if(!r.isActive(i))return!1;const a=r.getAttributes(i);return s.updateAttributes(i,{tight:e??!(a!=null&&a.tight)})}return t.options.listTypes.some(i=>o(i))}}}}}),Zt=ae();function Oe(t,e){return Zt.inline.State.prototype.scanDelims.call({src:t,posMax:t.length}),new Zt.inline.State(t,null,null,[]).scanDelims(e,!0)}function Le(t,e,n,r){let s=t.substring(0,n)+t.substring(n+e.length);return s=s.substring(0,n+r)+e+s.substring(n+r),s}function Io(t,e,n,r){let s=n,o=t;for(;s<r&&!Oe(o,s).can_open;)o=Le(o,e,s,1),s++;return{text:o,from:s,to:r}}function Bo(t,e,n,r){let s=r,o=t;for(;s>n&&!Oe(o,s).can_close;)o=Le(o,e,s,-1),s--;return{text:o,from:n,to:s}}function Ro(t,e,n,r){let s={text:t,from:n,to:r};return s=Io(s.text,e,s.from,s.to),s=Bo(s.text,e,s.from,s.to),s.to-s.from<e.length+1&&(s.text=s.text.substring(0,s.from)+s.text.substring(s.to+e.length)),s.text}class jo extends Kn{constructor(e,n,r){super(e,n,r??{}),ot(this,"inTable",!1),this.inlines=[]}render(e,n,r){super.render(e,n,r);const s=this.inlines[this.inlines.length-1];if(s!=null&&s.start&&s!==null&&s!==void 0&&s.end){const{delimiter:o,start:i,end:a}=this.normalizeInline(s);this.out=Ro(this.out,o,i,a),this.inlines.pop()}}markString(e,n,r,s){const o=this.marks[e.type.name];if(o.expelEnclosingWhitespace)if(n)this.inlines.push({start:this.out.length,delimiter:o.open});else{const i=this.inlines.pop();this.inlines.push({...i,end:this.out.length})}return super.markString(e,n,r,s)}normalizeInline(e){let{start:n}=e;for(;this.out.charAt(n).match(/\s/);)n++;return{...e,start:n}}}const Pe=L.create({name:"markdownHTMLMark",addStorage(){return{markdown:{serialize:{open(t,e){var n,r;return this.editor.storage.markdown.options.html&&(n=(r=te(e))===null||r===void 0?void 0:r[0])!==null&&n!==void 0?n:""},close(t,e){var n,r;return this.editor.storage.markdown.options.html&&(n=(r=te(e))===null||r===void 0?void 0:r[1])!==null&&n!==void 0?n:""}},parse:{}}}}});function te(t){const e=t.type.schema,n=e.text(" ",[t]),r=J(P.from(n),e).match(/^(<.*?>) (<\/.*?>)$/);return r?[r[1],r[2]]:null}function Pt(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function Do(t){return t?.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Wo(t){const e=t.parentElement,n=e.cloneNode();for(;e.firstChild&&e.firstChild!==t;)n.appendChild(e.firstChild);n.childNodes.length>0&&e.parentElement.insertBefore(n,e),e.parentElement.insertBefore(t,e),e.childNodes.length===0&&e.remove()}function _o(t){const e=t.parentNode;for(;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}const mt=M.create({name:"markdownHTMLNode",addStorage(){return{markdown:{serialize(t,e,n){this.editor.storage.markdown.options.html?t.write(Vo(e,n)):t.write(`[${e.type.name}]`),e.isBlock&&t.closeBlock(e)},parse:{}}}}});function Vo(t,e){const n=t.type.schema,r=J(P.from(t),n);return t.isBlock&&(e instanceof P||e.type.name===n.topNodeType.name)?Fo(r):r}function Fo(t){const e=Pt(t).firstElementChild;return e.innerHTML=e.innerHTML.trim()?`
${e.innerHTML}
`:`
`,e.outerHTML}const qo=M.create({name:"blockquote"}),Ko=qo.extend({addStorage(){return{markdown:{serialize:N.nodes.blockquote,parse:{}}}}}),Uo=M.create({name:"bulletList"}),He=Uo.extend({addStorage(){return{markdown:{serialize(t,e){return t.renderList(e,"  ",()=>(this.editor.storage.markdown.options.bulletListMarker||"-")+" ")},parse:{}}}}}),Go=M.create({name:"codeBlock"}),Jo=Go.extend({addStorage(){return{markdown:{serialize(t,e){t.write("```"+(e.attrs.language||"")+`
`),t.text(e.textContent,!1),t.ensureNewLine(),t.write("```"),t.closeBlock(e)},parse:{setup(t){var e;t.set({langPrefix:(e=this.options.languageClassPrefix)!==null&&e!==void 0?e:"language-"})},updateDOM(t){t.innerHTML=t.innerHTML.replace(/\n<\/code><\/pre>/g,"</code></pre>")}}}}}}),Xo=M.create({name:"hardBreak"}),Ne=Xo.extend({addStorage(){return{markdown:{serialize(t,e,n,r){for(let s=r+1;s<n.childCount;s++)if(n.child(s).type!=e.type){t.write(t.inTable?mt.storage.markdown.serialize.call(this,t,e,n):`\\
`);return}},parse:{}}}}}),Yo=M.create({name:"heading"}),Qo=Yo.extend({addStorage(){return{markdown:{serialize:N.nodes.heading,parse:{}}}}}),Zo=M.create({name:"horizontalRule"}),ti=Zo.extend({addStorage(){return{markdown:{serialize:N.nodes.horizontal_rule,parse:{}}}}}),ei=M.create({name:"image"}),ni=ei.extend({addStorage(){return{markdown:{serialize:N.nodes.image,parse:{}}}}}),ri=M.create({name:"listItem"}),si=ri.extend({addStorage(){return{markdown:{serialize:N.nodes.list_item,parse:{}}}}}),oi=M.create({name:"orderedList"});function ii(t,e,n){let r=0;for(;n-r>0&&e.child(n-r-1).type.name===t.type.name;r++);return r}const ai=oi.extend({addStorage(){return{markdown:{serialize(t,e,n,r){const s=e.attrs.start||1,o=String(s+e.childCount-1).length,i=t.repeat(" ",o+2),a=ii(e,n,r)%2?") ":". ";t.renderList(e,i,d=>{const l=String(s+d);return t.repeat(" ",o-l.length)+l+a})},parse:{}}}}}),li=M.create({name:"paragraph"}),di=li.extend({addStorage(){return{markdown:{serialize:N.nodes.paragraph,parse:{}}}}});function yt(t){var e,n;return(e=t==null||(n=t.content)===null||n===void 0?void 0:n.content)!==null&&e!==void 0?e:[]}const ci=M.create({name:"table"}),ui=ci.extend({addStorage(){return{markdown:{serialize(t,e,n){if(!pi(e)){mt.storage.markdown.serialize.call(this,t,e,n);return}t.inTable=!0,e.forEach((r,s,o)=>{if(t.write("| "),r.forEach((i,a,d)=>{d&&t.write(" | ");const l=i.firstChild;l.textContent.trim()&&t.renderInline(l)}),t.write(" |"),t.ensureNewLine(),!o){const i=Array.from({length:r.childCount}).map(()=>"---").join(" | ");t.write(`| ${i} |`),t.ensureNewLine()}}),t.closeBlock(e),t.inTable=!1},parse:{}}}}});function ee(t){return t.attrs.colspan>1||t.attrs.rowspan>1}function pi(t){const e=yt(t),n=e[0],r=e.slice(1);return!(yt(n).some(s=>s.type.name!=="tableHeader"||ee(s)||s.childCount>1)||r.some(s=>yt(s).some(o=>o.type.name==="tableHeader"||ee(o)||o.childCount>1)))}const hi=M.create({name:"taskItem"}),mi=hi.extend({addStorage(){return{markdown:{serialize(t,e){const n=e.attrs.checked?"[x]":"[ ]";t.write(`${n} `),t.renderContent(e)},parse:{updateDOM(t){[...t.querySelectorAll(".task-list-item")].forEach(e=>{const n=e.querySelector("input");e.setAttribute("data-type","taskItem"),n&&(e.setAttribute("data-checked",n.checked),n.remove())})}}}}}}),fi=M.create({name:"taskList"}),gi=fi.extend({addStorage(){return{markdown:{serialize:He.storage.markdown.serialize,parse:{setup(t){t.use(Jn)},updateDOM(t){[...t.querySelectorAll(".contains-task-list")].forEach(e=>{e.setAttribute("data-type","taskList")})}}}}}}),bi=M.create({name:"text"}),yi=bi.extend({addStorage(){return{markdown:{serialize(t,e){t.text(Do(e.text))},parse:{}}}}}),ki=L.create({name:"bold"}),vi=ki.extend({addStorage(){return{markdown:{serialize:N.marks.strong,parse:{}}}}}),Mi=L.create({name:"code"}),wi=Mi.extend({addStorage(){return{markdown:{serialize:N.marks.code,parse:{}}}}}),xi=L.create({name:"italic"}),$i=xi.extend({addStorage(){return{markdown:{serialize:N.marks.em,parse:{}}}}}),Ti=L.create({name:"link"}),Ci=Ti.extend({addStorage(){return{markdown:{serialize:N.marks.link,parse:{}}}}}),Si=L.create({name:"strike"}),Ai=Si.extend({addStorage(){return{markdown:{serialize:{open:"~~",close:"~~",expelEnclosingWhitespace:!0},parse:{}}}}}),Ei=[Ko,He,Jo,Ne,Qo,ti,mt,ni,si,ai,di,ui,mi,gi,yi,vi,wi,Pe,$i,Ci,Ai];function it(t){var e,n;const r=(e=t.storage)===null||e===void 0?void 0:e.markdown,s=(n=Ei.find(o=>o.name===t.name))===null||n===void 0?void 0:n.storage.markdown;return r||s?{...s,...r}:null}class Oi{constructor(e){ot(this,"editor",null),this.editor=e}serialize(e){const n=new jo(this.nodes,this.marks,{hardBreakNodeName:Ne.name});return n.renderContent(e),n.out}get nodes(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.nodes).map(n=>[n,this.serializeNode(mt)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(n=>n.type==="node"&&this.serializeNode(n)).map(n=>[n.name,this.serializeNode(n)]))!==null&&e!==void 0?e:[])}}get marks(){var e;return{...Object.fromEntries(Object.keys(this.editor.schema.marks).map(n=>[n,this.serializeMark(Pe)])),...Object.fromEntries((e=this.editor.extensionManager.extensions.filter(n=>n.type==="mark"&&this.serializeMark(n)).map(n=>[n.name,this.serializeMark(n)]))!==null&&e!==void 0?e:[])}}serializeNode(e){var n;return(n=it(e))===null||n===void 0||(n=n.serialize)===null||n===void 0?void 0:n.bind({editor:this.editor,options:e.options})}serializeMark(e){var n;const r=(n=it(e))===null||n===void 0?void 0:n.serialize;return r?{...r,open:typeof r.open=="function"?r.open.bind({editor:this.editor,options:e.options}):r.open,close:typeof r.close=="function"?r.close.bind({editor:this.editor,options:e.options}):r.close}:null}}class Li{constructor(e,n){ot(this,"editor",null),ot(this,"md",null);let{html:r,linkify:s,breaks:o}=n;this.editor=e,this.md=this.withPatchedRenderer(ae({html:r,linkify:s,breaks:o}))}parse(e){let{inline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){this.editor.extensionManager.extensions.forEach(o=>{var i;return(i=it(o))===null||i===void 0||(i=i.parse)===null||i===void 0||(i=i.setup)===null||i===void 0?void 0:i.call({editor:this.editor,options:o.options},this.md)});const r=this.md.render(e),s=Pt(r);return this.editor.extensionManager.extensions.forEach(o=>{var i;return(i=it(o))===null||i===void 0||(i=i.parse)===null||i===void 0||(i=i.updateDOM)===null||i===void 0?void 0:i.call({editor:this.editor,options:o.options},s)}),this.normalizeDOM(s,{inline:n,content:e}),s.innerHTML}return e}normalizeDOM(e,n){let{inline:r,content:s}=n;return this.normalizeBlocks(e),e.querySelectorAll("*").forEach(o=>{var i;((i=o.nextSibling)===null||i===void 0?void 0:i.nodeType)===Node.TEXT_NODE&&!o.closest("pre")&&(o.nextSibling.textContent=o.nextSibling.textContent.replace(/^\n/,""))}),r&&this.normalizeInline(e,s),e}normalizeBlocks(e){const n=Object.values(this.editor.schema.nodes).filter(r=>r.isBlock).map(r=>{var s;return(s=r.spec.parseDOM)===null||s===void 0?void 0:s.map(o=>o.tag)}).flat().filter(Boolean).join(",");n&&[...e.querySelectorAll(n)].forEach(r=>{r.parentElement.matches("p")&&Wo(r)})}normalizeInline(e,n){var r;if((r=e.firstElementChild)!==null&&r!==void 0&&r.matches("p")){var s,o,i,a;const d=e.firstElementChild,{nextElementSibling:l}=d,c=(s=(o=n.match(/^\s+/))===null||o===void 0?void 0:o[0])!==null&&s!==void 0?s:"",u=l?"":(i=(a=n.match(/\s+$/))===null||a===void 0?void 0:a[0])!==null&&i!==void 0?i:"";if(n.match(/^\n\n/)){d.innerHTML=`${d.innerHTML}${u}`;return}_o(d),e.innerHTML=`${c}${e.innerHTML}${u}`}}withPatchedRenderer(e){const n=r=>function(){const s=r(...arguments);return s===`
`?s:s[s.length-1]===`
`?s.slice(0,-1):s};return e.renderer.rules.hardbreak=n(e.renderer.rules.hardbreak),e.renderer.rules.softbreak=n(e.renderer.rules.softbreak),e.renderer.rules.fence=n(e.renderer.rules.fence),e.renderer.rules.code_block=n(e.renderer.rules.code_block),e.renderer.renderToken=n(e.renderer.renderToken.bind(e.renderer)),e}}const Pi=T.create({name:"markdownClipboard",addOptions(){return{transformPastedText:!1,transformCopiedText:!1}},addProseMirrorPlugins(){return[new E({key:new O("markdownClipboard"),props:{clipboardTextParser:(t,e,n)=>{if(n||!this.options.transformPastedText)return null;const r=this.editor.storage.markdown.parser.parse(t,{inline:!0});return nt.fromSchema(this.editor.schema).parseSlice(Pt(r),{preserveWhitespace:!0,context:e})},clipboardTextSerializer:t=>this.options.transformCopiedText?this.editor.storage.markdown.serializer.serialize(t.content):null}})]}}),ta=T.create({name:"markdown",priority:50,addOptions(){return{html:!0,tightLists:!0,tightListClass:"tight",bulletListMarker:"-",linkify:!1,breaks:!1,transformPastedText:!1,transformCopiedText:!1}},addCommands(){const t=Ps.Commands.config.addCommands();return{setContent:(e,n,r)=>s=>t.setContent(s.editor.storage.markdown.parser.parse(e),n,r)(s),insertContentAt:(e,n,r)=>s=>t.insertContentAt(e,s.editor.storage.markdown.parser.parse(n,{inline:!0}),r)(s)}},onBeforeCreate(){this.editor.storage.markdown={options:{...this.options},parser:new Li(this.editor,this.options),serializer:new Oi(this.editor),getMarkdown:()=>this.editor.storage.markdown.serializer.serialize(this.editor.state.doc)},this.editor.options.initialContent=this.editor.options.content,this.editor.options.content=this.editor.storage.markdown.parser.parse(this.editor.options.content)},onCreate(){this.editor.options.content=this.editor.options.initialContent,delete this.editor.options.initialContent},addStorage(){return{}},addExtensions(){return[zo.configure({tight:this.options.tightLists,tightClass:this.options.tightListClass}),Pi.configure({transformPastedText:this.options.transformPastedText,transformCopiedText:this.options.transformCopiedText})]}});export{_i as F,Vi as M,Zi as O,ta as W,Yi as X,Ji as a,Xi as b,Qi as c,Ui as l,Gi as o,qi as s,Fi as w};
